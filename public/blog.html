<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VLArena · 复现日志（博客系统）</title>
  <script>window.tailwind={config:{darkMode:'class'}};</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .modal-backdrop{background:rgba(0,0,0,.55)}
    .quill-editor { height: 320px; }
    /* Dark theme adjustments for Quill */
    .dark .ql-toolbar.ql-snow { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); color:#e2e8f0; }
    .dark .ql-picker { color:#e2e8f0; }
    .dark .ql-stroke { stroke:#e2e8f0; }
    .dark .ql-fill { fill:#e2e8f0; }
    .dark .ql-container.ql-snow { background: transparent; border-color: rgba(255,255,255,0.1); color:#e2e8f0; }
    .dark .ql-editor { color:#e2e8f0; }
    .content p { margin: .5rem 0; }
    .content pre { background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:.75rem; border-radius:.75rem; overflow:auto; }
    .content code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; }
  </style>
  <script>
    // 初始主题：localStorage > 系统偏好 > 默认 dark
    (function(){
      const saved=localStorage.getItem('theme');
      const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
      const useDark=saved? saved==='dark' : (prefersDark||true);
      document.documentElement.classList.toggle('dark',useDark);
    })();
  </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <div class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(ellipse_at_top,rgba(34,211,238,0.20),transparent_45%),radial-gradient(ellipse_at_bottom,rgba(129,140,248,0.20),transparent_45%)]"></div>

  <!-- 顶部导航：统一风格 -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-slate-900/60 bg-slate-900/80 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-2">
        <span class="relative">
          <span class="absolute -inset-1 rounded-xl bg-cyan-500/30 blur-sm"></span>
          <span class="relative rounded-xl bg-gradient-to-br from-cyan-400 to-indigo-400 p-2 shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-950" viewBox="0 0 24 24" fill="currentColor"><path d="M11 3h2v4h-2zM4.222 5.636l1.414-1.414 2.828 2.829-1.414 1.413zM3 11h4v2H3zM5.636 19.778l2.828-2.828 1.414 1.414-2.828 2.828zM11 17h2v4h-2zM16.122 18.364l1.414-1.414 2.829 2.828-1.415 1.415zM17 11h4v2h-4zM18.364 7.05l-1.414 1.415-2.828-2.829 1.414-1.414z"/></svg>
          </span>
        </span>
        <span class="font-bold tracking-tight text-lg">VLArena</span>
        <span class="text-xs text-slate-400 hidden sm:inline">Vision · Language · Action Lab</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="index.html" class="text-slate-300 hover:text-white">首页</a>
        <a href="benchmark.html" class="text-slate-300 hover:text-white">Benchmark 榜单</a>
        <a href="paper_map.html" class="text-slate-300 hover:text-white">论文地图</a>
        <a href="datasets.html" class="text-slate-300 hover:text-white">数据与任务</a>
        <a href="repro.html" class="text-slate-100">复现日志</a>
        <a href="tools.html" class="text-slate-300 hover:text-white">工具与Playground</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 py-8">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">复现日志 · 博客系统</h1>
        <p class="mt-2 text-slate-300">记录训练与评测过程，支持写作、管理与分享；风格与全站一致。</p>
      </div>
      <button id="newPostBtn" class="rounded-xl px-4 py-2 bg-cyan-500/20 border border-cyan-400/40 hover:bg-cyan-400/25">新建文章</button>
    </div>

    <!-- 列表容器 -->
    <section id="postList" class="mt-6 space-y-4"></section>
  </main>

  <!-- 编辑器弹窗 -->
  <div id="editorModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" data-dismiss></div>
    <div class="relative w-full max-w-3xl rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-5">
      <div class="flex items-center justify-between">
        <h3 id="editorTitle" class="text-lg font-semibold">新建文章</h3>
        <button class="p-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10" data-dismiss>✕</button>
      </div>
      <div class="mt-3 space-y-3">
        <input id="postTitle" type="text" placeholder="请输入标题" class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none" />
        <div id="quillEditor" class="quill-editor"></div>
        <div class="flex justify-end gap-2">
          <button id="cancelBtn" class="rounded-xl px-3 py-1.5 bg-white/5 border border-white/10 hover:bg-white/10">取消</button>
          <button id="saveBtn" class="rounded-xl px-3 py-1.5 bg-indigo-500/20 border border-indigo-400/40 hover:bg-indigo-400/25">保存</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="border-t border-white/10 py-8">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 flex flex-col md:flex-row items-center justify-between gap-3 text-slate-400 text-sm">
      <div>© <span id="year"></span> VLArena · Vision · Language · Action Lab</div>
      <div class="flex items-center gap-3">
        <a class="hover:text-slate-200" href="benchmark.html">Benchmark 联合榜单</a>
        <a class="hover:text-slate-200" href="paper_map.html">论文地图</a>
        <a class="hover:text-slate-200" href="#">关于</a>
      </div>
    </div>
  </footer>

  <script>
    // ====== 本地数据 ======
    const postListEl = document.getElementById('postList');
    const editorModal = document.getElementById('editorModal');
    const postTitleEl = document.getElementById('postTitle');
    const editorTitle = document.getElementById('editorTitle');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const newPostBtn = document.getElementById('newPostBtn');

    let quill;
    let editingIndex = null;

    const storageKey = 'vlarena.blog.v1';
    const seedPosts = [
      {
        title: 'OpenVLA 7B 在 LIBERO 上的微调复现记录',
        date: new Date().toISOString(),
        content: `
          <div class="content">
            <p><strong>环境</strong>：A100 × 4，PyTorch 2.2，CUDA 12.1，accelerate。</p>
            <p><strong>数据</strong>：LIBERO SPATIAL/OBJECT 子集（各 2k 条）。</p>
            <pre><code>$ accelerate launch finetune.py \
  --model openvla-7b --dataset LIBERO \
  --method lora --lr 2e-5 --bs 32 --epochs 3</code></pre>
            <p><strong>结果</strong>：平均成功率 ~76.4%，长链路任务偏低。后续计划加入 PD&AC。</p>
          </div>
        `
      },
      {
        title: 'π₀ (pi-zero) 复现：数据清洗与 FAST 策略',
        date: new Date(Date.now()-86400000).toISOString(),
        content: `
          <div class="content">
            <p>对 π₀ 训练前的数据清洗非常关键，推荐：</p>
            <ul>
              <li>去除低质量/矛盾标注；</li>
              <li>轨迹标准化，平滑异常速度；</li>
              <li>FAST 推理时调优温度与 top‑p。</li>
            </ul>
            <p>清洗后，桥接任务 <em>Success@1</em> 从 59% → 63%。</p>
          </div>
        `
      },
      {
        title: 'SpatialVLA 训练小技巧：数据增强与可视化',
        date: new Date(Date.now()-172800000).toISOString(),
        content: `
          <div class="content">
            <p>数据增强建议：随机裁剪、颜色抖动、遮挡模拟；建议对 <code>depth</code> 通道做直方图均衡。</p>
            <p>可视化：将注意力图叠加在物体掩膜上，能直观发现 <em>Grounding</em> 失效样本。</p>
          </div>
        `
      }
    ];

    function loadPosts(){
      try{ const arr = JSON.parse(localStorage.getItem(storageKey)||'[]'); return Array.isArray(arr)? arr : [] }catch{ return [] }
    }
    function savePosts(arr){ localStorage.setItem(storageKey, JSON.stringify(arr)); }

    let posts = loadPosts();
    if(posts.length === 0){ posts = seedPosts; savePosts(posts); }

    // ====== 渲染 ======
    function renderPosts() {
      postListEl.innerHTML = '';
      if (!posts.length){
        const empty = document.createElement('div');
        empty.className = 'rounded-2xl border border-white/10 bg-white/5 p-6 text-slate-400 text-center';
        empty.textContent = '暂无文章，点击右上角“新建文章”开始写作';
        postListEl.appendChild(empty);
        return;
      }
      posts.forEach((post, index) => {
        const div = document.createElement('article');
        div.className = 'rounded-2xl border border-white/10 bg-white/5 p-5 hover:bg-white/10 transition';
        div.innerHTML = `
          <header class="flex items-center justify-between gap-3">
            <div>
              <h3 class="text-lg font-semibold leading-snug">${post.title}</h3>
              <div class="text-xs text-slate-400 mt-1">${new Date(post.date).toLocaleString()}</div>
            </div>
            <div class="shrink-0 flex items-center gap-2">
              <button class="px-2 py-1 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-sm" data-edit>编辑</button>
              <button class="px-2 py-1 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-sm text-red-300" data-del>删除</button>
            </div>
          </header>
          <section class="mt-3 text-slate-200 content">${post.content}</section>
        `;
        div.querySelector('[data-edit]').addEventListener('click',()=>editPost(index));
        div.querySelector('[data-del]').addEventListener('click',()=>deletePost(index));
        postListEl.appendChild(div);
      });
    }

    function openEditor(isNew = true) {
      editorModal.classList.remove('hidden');
      editorModal.classList.add('flex');
      if (!quill) {
        quill = new Quill('#quillEditor', { theme: 'snow' });
      }
      if (isNew) {
        editorTitle.textContent = '新建文章';
        postTitleEl.value = '';
        quill.root.innerHTML = '';
        editingIndex = null;
      }
    }
    function closeEditor() { editorModal.classList.add('hidden'); editorModal.classList.remove('flex'); }

    function savePost() {
      const title = postTitleEl.value.trim();
      const content = quill.root.innerHTML.trim();
      if (!title) { alert('标题不能为空'); return; }
      const record = { title, content, date: new Date().toISOString() };
      if (editingIndex !== null) posts[editingIndex] = record; else posts.unshift(record);
      savePosts(posts); renderPosts(); closeEditor();
    }

    function editPost(index) {
      openEditor(false);
      editorTitle.textContent = '编辑文章';
      postTitleEl.value = posts[index].title;
      quill.root.innerHTML = posts[index].content;
      editingIndex = index;
    }

    function deletePost(index) {
      if (confirm('确定删除这篇文章吗？')) {
        posts.splice(index, 1);
        savePosts(posts);
        renderPosts();
      }
    }

    // 事件绑定
    document.querySelectorAll('[data-dismiss]').forEach(el=> el.addEventListener('click', closeEditor));
    saveBtn.addEventListener('click', savePost);
    cancelBtn.addEventListener('click', closeEditor);
    newPostBtn.addEventListener('click', () => openEditor(true));

    // 初始
    document.getElementById('year').textContent=new Date().getFullYear();
    renderPosts();
  </script>
</body>
</html>
