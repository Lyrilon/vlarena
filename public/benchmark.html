<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VLArena Â· Benchmark è”åˆæ¦œå•</title>

  <!-- Tailwind CDNï¼ˆå¼€å¯ class æš—è‰²æ¨¡å¼ï¼‰ -->
  <script>
    window.tailwind = { config: { darkMode: 'class' } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .modal-backdrop { background-color: rgba(0,0,0,0.5); }
    .loader { border-top-color: #22d3ee; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <script>
    // åˆå§‹åŒ–ä¸»é¢˜ï¼šlocalStorage > ç³»ç»Ÿåå¥½ > é»˜è®¤ dark
    (function () {
      const saved = localStorage.getItem('theme')
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
      const useDark = saved ? saved === 'dark' : (prefersDark || true)
      document.documentElement.classList.toggle('dark', useDark)
    })()
  </script>
</head>
<body class="min-h-dvh bg-gradient-to-b from-slate-50 to-slate-100 text-slate-900 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 dark:text-slate-100">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/70 dark:bg-slate-900/70 border-b border-black/10 dark:border-white/10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-2">
        <span class="relative rounded-xl bg-gradient-to-br from-cyan-400 to-indigo-400 p-2 shadow">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-slate-950" viewBox="0 0 24 24" fill="currentColor"><path d="M11 3h2v4h-2zM4.222 5.636l1.414-1.414 2.828 2.829-1.414 1.413zM3 11h4v2H3zM5.636 19.778l2.828-2.828 1.414 1.414-2.828 2.828zM11 17h2v4h-2zM16.122 18.364l1.414-1.414 2.829 2.828-1.415 1.415zM17 11h4v2h-4zM18.364 7.05l-1.414 1.415-2.828-2.829 1.414-1.414z"/></svg>
        </span>
        <span class="font-bold tracking-tight text-lg">VLArena</span>
        <span class="text-xs text-slate-600 dark:text-slate-400 hidden sm:inline">Vision Â· Language Â· Action Lab</span>
      </a>
      <nav class="hidden md:flex items-center gap-4 text-sm">
        <a href="/" class="hover:underline">é¦–é¡µ</a>
        <a href="/repro" class="hover:underline">å¤ç°æ—¥å¿—</a>
        <a href="/playground" class="hover:underline">å®éªŒå°</a>
        <button id="theme-toggle" class="p-2 rounded-xl border border-black/10 dark:border-white/10 bg-white/60 dark:bg-white/5" title="åˆ‡æ¢ä¸»é¢˜">
          <span id="theme-icon"></span>
        </button>
      </nav>
    </div>
  </header>

  <div class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(ellipse_at_top,rgba(34,211,238,0.18),transparent_45%),radial-gradient(ellipse_at_bottom,rgba(129,140,248,0.18),transparent_45%)]"></div>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 py-10">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">Benchmark è”åˆæ¦œå•</h1>
        <p class="mt-2 text-slate-600 dark:text-slate-400">é›†ä¸­æµè§ˆå¸¸ç”¨åŸºå‡†ï¼ˆLIBERO / BRIDGE / CALVIN / RT-X / Open-X ...ï¼‰çš„æ¨¡å‹è¡¨ç°ä¸å¯¹æ¯”</p>
      </div>
      <a href="/" class="text-sm text-cyan-600 dark:text-cyan-300 hover:underline">è¿”å›é¦–é¡µ</a>
    </div>

    <!-- è”åˆåˆ—è¡¨å®¹å™¨ -->
    <div id="bench-list" class="mt-6 space-y-4"></div>

    <footer class="text-center mt-10 text-sm text-slate-600 dark:text-slate-400">ç”¨äºå±•ç¤º</footer>
  </main>

  <!-- Modalï¼šé˜…è¯»ç¬”è®°ï¼ˆæ²¿ç”¨ä½ çš„å®ç°ï¼‰ -->
  <div id="notes-modal" class="fixed inset-0 z-50 items-center justify-center hidden p-4">
    <div class="modal-backdrop fixed inset-0 transition-opacity"></div>
    <div class="bg-white dark:bg-slate-900 rounded-lg shadow-xl w-full max-w-2xl mx-auto z-10 transform transition-all scale-95 opacity-0 border border-black/10 dark:border-white/10">
      <div class="px-6 py-4 border-b border-black/10 dark:border-white/10">
        <h3 class="text-xl font-semibold" id="modal-title">é˜…è¯»ç¬”è®°</h3>
      </div>
      <div class="p-6">
        <div id="modal-content" class="text-base leading-relaxed text-slate-700 dark:text-slate-300 min-h-36">
          <div id="loader" class="flex justify-center items-center h-full">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 dark:border-slate-700 h-12 w-12"></div>
          </div>
        </div>
      </div>
      <div class="px-6 py-4 bg-black/[0.03] dark:bg-white/5 rounded-b-lg text-right border-t border-black/10 dark:border-white/10">
        <button id="close-modal-btn" class="px-4 py-2 bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-100 rounded-lg hover:bg-black/5 dark:hover:bg-white/10 border border-black/10 dark:border-white/10">å…³é—­</button>
      </div>
    </div>
  </div>

  <script>
    // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
    const themeBtn = document.getElementById('theme-toggle')
    const themeIcon = document.getElementById('theme-icon')
    function renderThemeIcon() {
      const isDark = document.documentElement.classList.contains('dark')
      themeIcon.innerHTML = isDark
        ? '<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m6.364.636-1.414 1.414M21 12h-2m-1.222 6.364-1.414-1.414M12 19v2M6.05 17.95l-1.414 1.414M5 12H3m3.05-5.95L4.636 4.636M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/></svg>'
        : '<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="currentColor"><path d="M21.64 13a9 9 0 1 1-10.63-10.6 1 1 0 0 1 1.11 1.45A7 7 0 1 0 20.19 12a1 1 0 0 1 1.45 1.11Z"/></svg>'
    }
    themeBtn?.addEventListener('click', () => {
      const next = !document.documentElement.classList.contains('dark')
      document.documentElement.classList.toggle('dark', next)
      localStorage.setItem('theme', next ? 'dark' : 'light')
      renderThemeIcon()
    })
    renderThemeIcon()

    // ==================== æ•°æ®å®šä¹‰ ====================
    // è¯´æ˜ï¼šæ¯ä¸ª benchmark å®šä¹‰è‡ªå·±çš„åˆ—ï¼ˆcolumnsï¼‰ä¸æ•°æ®ï¼ˆrowsï¼‰ã€‚å¦‚æœæŸåˆ—æ˜¯ç™¾åˆ†æ¯”ï¼Œå†™å­—ç¬¦ä¸²ç™¾åˆ†æ¯”ï¼ˆå¦‚ '96.8%'ï¼‰ã€‚
    const benchmarks = [
      {
        id: 'libero',
        name: 'LIBERO',
        desc: 'å¤šä»»åŠ¡æœºå™¨äººæ“ä½œåŸºå‡†ï¼ŒåŒ…å« SPATIAL / OBJECT / GOAL / LONG å››ç±»ä»»åŠ¡ç»´åº¦ã€‚',
        columns: ['Method', 'SPATIAL', 'OBJECT', 'GOAL', 'LONG', 'Average', 'Link', 'Actions'],
        rows: [
          { name: 'Diffusion Policy (scratch) [5, 17]', spatial: '78.3%', object: '92.5%', goal: '68.3%', long: '50.5%', average: '72.4%', link: '#' },
          { name: 'Octo (fine-tuned) [49, 62]', spatial: '78.9%', object: '85.7%', goal: '84.6%', long: '51.1%', average: '75.1%', link: '#' },
          { name: 'OpenVLA (fine-tuned) [23, 42]', spatial: '84.7%', object: '88.4%', goal: '79.2%', long: '53.7%', average: '76.5%', link: '#' },
          { name: 'SpatialVLA [59]', spatial: '88.2%', object: '89.9%', goal: '78.6%', long: '55.5%', average: '78.1%', link: '#' },
          { name: 'CoT-VLA [75]', spatial: '87.5%', object: '91.6%', goal: '87.6%', long: '69.0%', average: '81.1%', link: '#' },
          { name: 'DIT Policy (fine-tuned) [13]', spatial: '84.2%', object: '96.3%', goal: '85.4%', long: '63.8%', average: '82.4%', link: '#' },
          { name: 'Ï€â‚€ + FAST (fine-tuned) [38, 58]', spatial: '96.4%', object: '96.8%', goal: '88.6%', long: '60.2%', average: '85.5%', link: '#' },
          { name: 'OpenVLA (fine-tuned) + PD&AC', spatial: '91.3%', object: '92.7%', goal: '90.5%', long: '86.5%', average: '90.2%', link: '#' },
          { name: 'UniVLA (å¤ç°)', spatial: '94.8%', object: '97.2%', goal: '90.6%', long: '92.4%', average: '93.8%', link: '#' },
          { name: 'Ï€â‚€ (fine-tuned) [3]', spatial: '96.8%', object: '98.8%', goal: '95.8%', long: '85.2%', average: '94.2%', link: '#' },
          { name: 'OpenVLA (fine-tuned) + PD&AC, Cont-Diffusion', spatial: '96.9%', object: '98.1%', goal: '95.5%', long: '91.1%', average: '95.4%', link: '#' },
          { name: 'UniVLA', spatial: '95.4%', object: '98.8%', goal: '93.6%', long: '94.0%', average: '95.5%', link: '#' },
          { name: 'OpenVLA-OFT (OpenVLA (fine-tuned) + PD&AC, Cont-L1) (ours)', spatial: '97.6%', object: '98.4%', goal: '97.9%', long: '94.5%', average: '97.1%', link: '#' }
        ]
      },
      {
        id: 'bridge',
        name: 'BRIDGE v2',
        desc: 'è§„æ¨¡åŒ–æ¨¡ä»¿å­¦ä¹ æ•°æ®é›†ä¸è¯„æµ‹å¥—ä»¶ï¼Œå…³æ³¨è·¨åœºæ™¯/è·¨ä»»åŠ¡æ³›åŒ–èƒ½åŠ›ï¼ˆæ­¤å¤„ç¤ºä¾‹å­—æ®µï¼‰ã€‚',
        columns: ['Method', 'Success@1', 'Success@5', 'Average', 'Link', 'Actions'],
        rows: [
          { name: 'OpenVLA (ft)', s1: '62.3%', s5: '81.2%', average: '71.8%', link: '#' },
          { name: 'Ï€â‚€ (ft)', s1: '65.1%', s5: '83.0%', average: '74.0%', link: '#' },
          { name: 'UniVLA (å¤ç°)', s1: '63.4%', s5: '82.6%', average: '73.0%', link: '#' },
          { name: 'CoT-VLA', s1: '60.5%', s5: '80.9%', average: '70.7%', link: '#' }
        ]
      },
      {
        id: 'calvin',
        name: 'CALVIN',
        desc: 'å¤šä»»åŠ¡æœºæ¢°è‡‚æ“æ§åŸºå‡†ï¼Œå¼ºè°ƒé•¿æœŸä¾èµ–ä¸ç›®æ ‡åºåˆ—ã€‚',
        columns: ['Method', 'SR (Seen)', 'SR (Unseen)', 'Average', 'Link', 'Actions'],
        rows: [
          { name: 'OpenVLA (ft)', seen: '89.2%', unseen: '63.3%', average: '76.3%', link: '#' },
          { name: 'SpatialVLA', seen: '90.4%', unseen: '65.1%', average: '77.8%', link: '#' },
          { name: 'Ï€â‚€ (ft)', seen: '92.0%', unseen: '68.7%', average: '80.3%', link: '#' },
          { name: 'UniVLA (å¤ç°)', seen: '91.5%', unseen: '67.4%', average: '79.5%', link: '#' }
        ]
      },
      {
        id: 'rtx',
        name: 'RT-X / Open-X',
        desc: 'è·¨æœºå™¨äººè·¨ä»»åŠ¡çš„é€šç”¨è¡Œä¸ºå…‹éš†è¯„æµ‹ï¼ˆç¤ºä¾‹å­—æ®µï¼‰ã€‚',
        columns: ['Method', 'BC Score', 'Generalization', 'Average', 'Link', 'Actions'],
        rows: [
          { name: 'OpenVLA (ft)', bc: '78.1', gen: '74.3', average: '76.2', link: '#' },
          { name: 'Ï€â‚€ (ft)', bc: '80.6', gen: '76.5', average: '78.6', link: '#' },
          { name: 'UniVLA (å¤ç°)', bc: '79.9', gen: '76.1', average: '78.0', link: '#' }
        ]
      }
    ]

    // ==================== é€šç”¨æ¸²æŸ“ & é«˜äº® ====================
    function topStats(rows, keys){
      const stats = {}
      keys.forEach(k => {
        const vals = rows.map(r => parseFloat((r[k]||'').toString()))
          .filter(v => !Number.isNaN(v))
        const uniq = [...new Set(vals)].sort((a,b)=>b-a)
        stats[k] = { top1: uniq[0] ?? -1, top2: uniq[1] ?? -1 }
      })
      return stats
    }

    function clsFor(key, val, stats){
      const v = parseFloat((val||'').toString())
      if (Number.isNaN(v)) return ''
      if (v === stats[key]?.top1) return 'font-bold text-cyan-600 dark:text-cyan-300'
      if (v === stats[key]?.top2) return 'font-semibold text-indigo-600 dark:text-indigo-300'
      return ''
    }

    function renderTable(bench){
      const card = document.createElement('div')
      card.className = 'rounded-2xl border border-black/10 dark:border-white/10 bg-white/70 dark:bg-white/5 backdrop-blur shadow'

      // å¤´éƒ¨ï¼ˆå¯å±•å¼€ï¼‰
      const head = document.createElement('button')
      head.className = 'w-full flex items-center justify-between px-5 py-4'
      head.innerHTML = `
        <div>
          <div class="text-lg font-semibold">${bench.name}</div>
          <div class="text-sm text-slate-600 dark:text-slate-400">${bench.desc}</div>
        </div>
        <svg class="size-5 text-slate-500 transition-transform" data-chevron viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/></svg>
      `

      const panel = document.createElement('div')
      panel.className = 'hidden border-t border-black/10 dark:border-white/10'

      // æ„é€ åˆ—é”®æ˜ å°„ï¼ˆæ ¹æ® benchmark ç±»å‹ï¼‰
      let numericKeys = []
      let headers = ''
      if (bench.id === 'libero'){
        headers = `<th class="px-6 py-3">Method</th>
                   <th class="px-6 py-3 text-center">SPATIAL</th>
                   <th class="px-6 py-3 text-center">OBJECT</th>
                   <th class="px-6 py-3 text-center">GOAL</th>
                   <th class="px-6 py-3 text-center">LONG</th>
                   <th class="px-6 py-3 text-center">Average</th>
                   <th class="px-6 py-3 text-center">Link</th>
                   <th class="px-6 py-3 text-center">Actions</th>`
        numericKeys = ['spatial','object','goal','long','average']
      } else if (bench.id === 'bridge'){
        headers = `<th class="px-6 py-3">Method</th>
                   <th class="px-6 py-3 text-center">Success@1</th>
                   <th class="px-6 py-3 text-center">Success@5</th>
                   <th class="px-6 py-3 text-center">Average</th>
                   <th class="px-6 py-3 text-center">Link</th>
                   <th class="px-6 py-3 text-center">Actions</th>`
        numericKeys = ['s1','s5','average']
      } else if (bench.id === 'calvin'){
        headers = `<th class="px-6 py-3">Method</th>
                   <th class="px-6 py-3 text-center">SR (Seen)</th>
                   <th class="px-6 py-3 text-center">SR (Unseen)</th>
                   <th class="px-6 py-3 text-center">Average</th>
                   <th class="px-6 py-3 text-center">Link</th>
                   <th class="px-6 py-3 text-center">Actions</th>`
        numericKeys = ['seen','unseen','average']
      } else {
        headers = `<th class="px-6 py-3">Method</th>
                   <th class="px-6 py-3 text-center">BC Score</th>
                   <th class="px-6 py-3 text-center">Generalization</th>
                   <th class="px-6 py-3 text-center">Average</th>
                   <th class="px-6 py-3 text-center">Link</th>
                   <th class="px-6 py-3 text-center">Actions</th>`
        numericKeys = ['bc','gen','average']
      }

      const stats = topStats(bench.rows, numericKeys)
      const bodyRows = bench.rows.map(r => {
        const isRepro = /å¤ç°/.test(r.name)
        const rowBase = 'hover:bg-white dark:hover:bg-white/10 transition ' + (isRepro ? 'text-red-600 font-medium' : '')
        const nameTd = `<td class="px-6 py-4 font-medium ${isRepro ? '' : 'text-slate-900 dark:text-slate-100'} whitespace-nowrap">${r.name}</td>`

        function cell(val, key){
          return `<td class="px-6 py-4 text-center ${clsFor(key, val, stats)}">${val ?? '-'}</td>`
        }

        let metricTds = ''
        if (bench.id === 'libero'){
          metricTds = [cell(r.spatial,'spatial'), cell(r.object,'object'), cell(r.goal,'goal'), cell(r.long,'long'), cell(r.average,'average')].join('')
        } else if (bench.id === 'bridge'){
          metricTds = [cell(r.s1,'s1'), cell(r.s5,'s5'), cell(r.average,'average')].join('')
        } else if (bench.id === 'calvin'){
          metricTds = [cell(r.seen,'seen'), cell(r.unseen,'unseen'), cell(r.average,'average')].join('')
        } else {
          metricTds = [cell(r.bc,'bc'), cell(r.gen,'gen'), cell(r.average,'average')].join('')
        }

        const linkTd = `<td class="px-6 py-4 text-center"><a href="${r.link||'#'}" target="_blank" class="text-cyan-600 dark:text-cyan-300 hover:underline">é“¾æ¥</a></td>`
        const actTd  = `<td class="px-6 py-4 text-center"><button class="view-notes-btn font-medium ${isRepro ? 'text-red-600 hover:text-red-800' : 'text-cyan-700 dark:text-cyan-300 hover:underline'}" data-model="${r.name}">ğŸ“– é˜…è¯»ç¬”è®°</button></td>`

        return `<tr class="${rowBase}">${nameTd}${metricTds}${linkTd}${actTd}</tr>`
      }).join('')

      panel.innerHTML = `
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left">
            <thead class="text-xs uppercase">
              <tr class="bg-black/[0.03] dark:bg-white/5 text-slate-600 dark:text-slate-300">${headers}</tr>
            </thead>
            <tbody class="divide-y divide-black/5 dark:divide-white/10 bg-white/60 dark:bg-white/5">${bodyRows}</tbody>
          </table>
        </div>
        <div class="p-4 bg-black/[0.03] dark:bg-white/5 border-t border-black/10 dark:border-white/10 text-xs text-slate-600 dark:text-slate-400">
          <span class="mr-6 inline-flex items-center"><strong class="text-cyan-600 dark:text-cyan-300">è“è‰²å­—ä½“</strong>: è¯¥åˆ—æœ€ä½³</span>
          <span class="mr-6 inline-flex items-center"><strong class="text-indigo-600 dark:text-indigo-300">é›è“å­—ä½“</strong>: è¯¥åˆ—æ¬¡ä½³</span>
          <span class="inline-flex items-center"><strong class="text-red-600">çº¢è‰²è¡Œ</strong>: ä½ çš„å¤ç°ç»“æœ</span>
        </div>
      `

      head.addEventListener('click', () => {
        const chevron = head.querySelector('[data-chevron]')
        const isHidden = panel.classList.contains('hidden')
        panel.classList.toggle('hidden')
        chevron.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0)'
      })

      card.appendChild(head)
      card.appendChild(panel)
      return card
    }

    // æ¸²æŸ“æ‰€æœ‰ benchmark å¡ç‰‡
    const list = document.getElementById('bench-list')
    benchmarks.forEach(b => list.appendChild(renderTable(b)))

    // ========= Modal é€»è¾‘ï¼ˆä¸ä½ åŸå®ç°ä¸€è‡´ï¼‰ =========
    const modal = document.getElementById('notes-modal')
    const modalTitle = document.getElementById('modal-title')
    const modalContent = document.getElementById('modal-content')
    const loader = document.getElementById('loader')
    const closeModalBtn = document.getElementById('close-modal-btn')
    const modalBackdrop = modal.querySelector('.modal-backdrop')

    function showModal(){ modal.classList.remove('hidden'); modal.classList.add('flex'); setTimeout(()=>{ modal.querySelector('.z-10')?.classList?.remove?.('scale-95','opacity-0') }, 10) }
    function hideModal(){ modal.querySelector('.z-10')?.classList?.add?.('scale-95','opacity-0'); setTimeout(()=>{ modal.classList.add('hidden'); modal.classList.remove('flex') }, 200) }
    closeModalBtn.addEventListener('click', hideModal)
    modalBackdrop.addEventListener('click', hideModal)

    async function getReadingNotes(modelName){
      showModal(); modalTitle.textContent = `å…³äº â€œ${modelName}â€ çš„é˜…è¯»ç¬”è®°`; loader.style.display='flex'; modalContent.innerHTML=''; modalContent.appendChild(loader)

      const prompt = `è¯·ä¸ºAIæ¨¡å‹ '${modelName}' ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„ä¸­æ–‡é˜…è¯»ç¬”è®°ã€‚ç¬”è®°åº”åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š1. **æ ¸å¿ƒæ€æƒ³**ï¼›2. **æ¶æ„è§£æ**ï¼›3. **å…³é”®è´¡çŒ®**ï¼›4. **æ½œåœ¨åº”ç”¨**ã€‚è¦æ±‚ç»“æ„æ¸…æ™°ã€è¦ç‚¹çªå‡ºã€‚`
      const apiKey = 'YOUR_API_KEY'
      if (apiKey === 'YOUR_API_KEY') { loader.style.display='none'; modalContent.innerHTML = `<strong>æ³¨æ„ï¼š</strong>è¯·åœ¨ä»£ç ä¸­æ›¿æ¢ \"YOUR_API_KEY\" ä¸ºä½ çš„ Gemini API å¯†é’¥åå†ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚`; return }

      const payload = { contents: [{ role:'user', parts:[{ text: prompt }] }] }
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`
      try {
        let response; let retries=3; let delay=1000
        for (let i=0;i<retries;i++){
          response = await fetch(apiUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
          if (response.ok) break; await new Promise(r=>setTimeout(r, delay)); delay*=2
        }
        if (!response.ok) throw new Error(`API è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`)
        const result = await response.json()
        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text
        loader.style.display='none'; modalContent.innerHTML = (text||'æ— è¿”å›å†…å®¹').replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
      } catch (e){ loader.style.display='none'; modalContent.textContent = `æŠ±æ­‰ï¼Œæ— æ³•åŠ è½½é˜…è¯»ç¬”è®°ï¼š${e.message}` }
    }

    // ä»£ç†æ‰€æœ‰ â€œé˜…è¯»ç¬”è®°â€ æŒ‰é’®
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.view-notes-btn')
      if (!btn) return
      const modelName = btn.getAttribute('data-model')
      getReadingNotes(modelName)
    })
  </script>
</body>
</html>