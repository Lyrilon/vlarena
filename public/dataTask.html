<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VLArena Â· æ•°æ®ä¸ä»»åŠ¡ç®¡ç†</title>

  <!-- Tailwind -->
  <script>window.tailwind={config:{darkMode:'class'}};</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{color-scheme:light dark}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple Color Emoji','Segoe UI Emoji'}
    .dragging{opacity:.5}
    .modal-backdrop{background:rgba(0,0,0,.55)}

    /* ===== è‡ªå®šä¹‰ä¸‹æ‹‰ï¼ˆæ¢çš®ï¼‰ ===== */
/* ===== è‡ªå®šä¹‰ä¸‹æ‹‰ï¼ˆæ¢çš®ï¼‰ ===== */
.c-select{
  position: relative;
  display: block;   /* å…³é”®ï¼šä½œä¸ºå—çº§å…ƒç´  */
  width: 100%;      /* å…³é”®ï¼šå æ»¡æ‰€åœ¨åˆ—/å®¹å™¨ */
  flex: 1 1 auto;   /* åœ¨ flex å®¹å™¨é‡Œä¹Ÿèƒ½é“ºæ»¡ */
  z-index: 10;
}
.c-select .c-btn{
  display:flex; align-items:center; justify-content:space-between;
  width:100%; padding:.5rem .75rem; border-radius:.75rem;
  border:1px solid rgba(255,255,255,.1); background:rgba(255,255,255,.05);
}
.c-select .c-btn:hover{ background:rgba(255,255,255,.08); }
.c-select .c-menu{
  position:absolute; left:0; right:0; margin-top:.25rem;
  border:1px solid rgba(255,255,255,.1); background:rgba(2,6,23,.9);
  -webkit-backdrop-filter:blur(6px); backdrop-filter:blur(6px);
  border-radius:.75rem; box-shadow:0 10px 30px rgba(0,0,0,.35);
  z-index:50; max-height:16rem; overflow:auto;
}
.c-select .c-opt{ padding:.5rem .75rem; cursor:pointer; font-size:.875rem; color:rgba(226,232,240,.9); }
.c-select .c-opt[aria-selected="true"]{ background:rgba(34,211,238,.15); color:#e6fbff; }
.c-select .c-opt:hover{ background:rgba(148,163,184,.2); }
.c-select .hidden{ display:none; }
/* éšè—åŸç”Ÿ selectï¼Œä½†ä¿ç•™è¡¨å•è¯­ä¹‰ä¸å¯èšç„¦æ€§ */
.c-select .sr-hidden{
  position:absolute !important; inset:0 !important; width:100% !important; height:100% !important;
  opacity:0 !important; pointer-events:none !important;
}

  </style>

  <script>
    // åˆå§‹ä¸»é¢˜ï¼šlocalStorage > ç³»ç»Ÿ > é»˜è®¤ dark
    (function(){
      const saved=localStorage.getItem('theme');
      const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.classList.toggle('dark', saved? saved==='dark' : (prefersDark||true));
    })();
  </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <div class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(ellipse_at_top,rgba(34,211,238,0.20),transparent_45%),radial-gradient(ellipse_at_bottom,rgba(129,140,248,0.20),transparent_45%)]"></div>

  <!-- é¡¶éƒ¨å¯¼èˆªï¼šä¸ç«™ç‚¹ä¸€è‡´ -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-slate-900/60 bg-slate-900/80 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-2">
        <span class="relative"><span class="absolute -inset-1 rounded-xl bg-cyan-500/30 blur-sm"></span><span class="relative rounded-xl bg-gradient-to-br from-cyan-400 to-indigo-400 p-2 shadow-lg"><svg class="w-5 h-5 text-slate-950" viewBox="0 0 24 24" fill="currentColor"><path d="M11 3h2v4h-2zM4.222 5.636l1.414-1.414 2.828 2.829-1.414 1.413zM3 11h4v2H3zM5.636 19.778l2.828-2.828 1.414 1.414-2.828 2.828zM11 17h2v4h-2zM16.122 18.364l1.414-1.414 2.829 2.828-1.415 1.415zM17 11h4v2h-4zM18.364 7.05l-1.414 1.415-2.828-2.829 1.414-1.414z"/></svg></span></span>
        <span class="font-bold tracking-tight text-lg">VLArena</span>
        <span class="text-xs text-slate-400 hidden sm:inline">Vision Â· Language Â· Action Lab</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="index.html" class="text-slate-300 hover:text-white">é¦–é¡µ</a>
        <a href="benchmark.html" class="text-slate-300 hover:text-white">Benchmark æ¦œå•</a>
        <a href="paper_map.html" class="text-slate-300 hover:text-white">è®ºæ–‡åœ°å›¾</a>
        <a href="datasets.html" class="text-slate-100">æ•°æ®ä¸ä»»åŠ¡</a>
        <a href="repro.html" class="text-slate-300 hover:text-white">å¤ç°æ—¥å¿—</a>
        <a href="tools.html" class="text-slate-300 hover:text-white">å·¥å…·ä¸Playground</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 py-8">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">æ•°æ®ä¸ä»»åŠ¡ Â· ç®¡ç†é¢æ¿</h1>
        <p class="mt-2 text-slate-300">é›†ä¸­ç®¡ç† <span class="text-cyan-300 font-semibold">Benchmark</span> ä¸ <span class="text-indigo-300 font-semibold">Dataset</span> å¡ç‰‡ã€‚</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="restoreBtn" class="rounded-xl px-3 py-1.5 bg-white/5 border border-white/10 hover:bg-white/10 text-sm">æ¢å¤é»˜è®¤</button>
        <button id="exportBtn" class="rounded-xl px-3 py-1.5 bg-white/5 border border-white/10 hover:bg-white/10 text-sm">å¯¼å‡º JSON</button>
        <label class="rounded-xl px-3 py-1.5 bg-white/5 border border-white/10 hover:bg-white/10 text-sm cursor-pointer">å¯¼å…¥ JSON<input id="importInput" type="file" accept="application/json" class="hidden"/></label>
        <button id="addCardBtn" class="rounded-xl px-3 py-1.5 bg-cyan-500/20 border border-cyan-400/40 hover:bg-cyan-400/25 text-sm">æ–°å»ºå¡ç‰‡</button>
      </div>
    </div>

    <!-- è¿‡æ»¤ä¸æœç´¢ -->
    <section class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
      <div class="grid md:grid-cols-3 gap-3 items-end">
        <div>
          <label class="text-xs text-slate-400">æœç´¢ï¼ˆåç§° / æ ‡ç­¾ / ç®€ä»‹ï¼‰</label>
          <div class="mt-1 flex items-center gap-2 rounded-2xl bg-white/5 border border-white/10 px-3 py-2">
            <span class="text-slate-400">ğŸ”</span>
            <input id="searchInput" placeholder="å¦‚ï¼šLIBERO / BRIDGE / æœºå™¨äººæ“ä½œ" class="bg-transparent outline-none w-full"/>
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-400">ç±»å‹</label>
          <div class="mt-1 flex gap-2">
            <select id="typeFilter" class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2">
              <option value="all">å…¨éƒ¨</option>
              <option value="benchmark">Benchmark</option>
              <option value="dataset">Dataset</option>
            </select>
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-400">æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼Œæ¨¡ç³ŠåŒ¹é…ï¼‰</label>
          <input id="tagFilter" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="manipulation, language, sim2real"/>
        </div>
      </div>
    </section>

    <!-- å®¹å™¨ï¼šå¡ç‰‡åˆ—è¡¨ï¼ˆå¯æ‹–æ‹½æ’åºï¼‰ -->
    <section class="mt-6">
      <div id="cards" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      <div id="statusMessage" class="hidden rounded-2xl border border-white/10 bg-white/5 p-8 text-center text-slate-400"></div>
    </section>
  </main>

  <!-- å¼¹çª—ï¼šæ–°å¢ / ç¼–è¾‘å¡ç‰‡ -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="modal-backdrop absolute inset-0" data-dismiss></div>
    <div class="relative w-full max-w-2xl rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-6">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold" id="modalTitle">æ–°å»ºå¡ç‰‡</h3>
        <button class="p-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10" data-dismiss>âœ•</button>
      </div>
      <form id="cardForm" class="mt-4 space-y-3">
        <div class="grid sm:grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-400">ç±»å‹</label>
            <select name="type" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" required>
              <option value="benchmark">Benchmark</option>
              <option value="dataset">Dataset</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-slate-400">åç§°</label>
            <input name="name" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="LIBERO / BRIDGE / CALVIN / RT-X" required />
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-400">ç®€ä»‹</label>
          <textarea name="desc" rows="3" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="ä¸€å¥è¯è¯´æ˜æ•°æ®/åŸºå‡†çš„ç‰¹ç‚¹"></textarea>
        </div>
        <div>
          <label class="text-xs text-slate-400">è¯¦ç»†ä»‹ç»ï¼ˆæ”¯æŒ Markdownï¼‰</label>
          <textarea name="details" rows="6" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="åœ¨æ­¤è¾“å…¥è¯¦ç»†å†…å®¹ï¼Œæ”¯æŒ Markdown è¯­æ³•..."></textarea>
        </div>
        <div class="grid sm:grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-400">å®˜ç½‘/ä¸»é¡µé“¾æ¥</label>
            <input name="homepage" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="https://..." />
          </div>
          <div>
            <label class="text-xs text-slate-400">ä»£ç ä»“åº“ï¼ˆå¯é€‰ï¼‰</label>
            <input name="repo" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="https://github.com/..." />
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-400">æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <input name="tags" class="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="manipulation, language, sim2real" />
        </div>
        <div class="flex items-center justify-end gap-2 pt-2">
          <button type="button" class="rounded-xl px-3 py-1.5 bg-white/5 border border-white/10 hover:bg-white/10" data-dismiss>å–æ¶ˆ</button>
          <button type="submit" class="rounded-xl px-3 py-1.5 bg-cyan-500/20 border border-cyan-400/40 hover:bg-cyan-400/25">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="border-t border-white/10 py-8">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 flex flex-col md:flex-row items-center justify-between gap-3 text-slate-400 text-sm">
      <div>Â© <span id="year"></span> VLArena Â· Vision Â· Language Â· Action Lab</div>
      <div class="flex items-center gap-3">
        <a class="hover:text-slate-200" href="benchmark.html">Benchmark è”åˆæ¦œå•</a>
        <a class="hover:text-slate-200" href="paper_map.html">è®ºæ–‡åœ°å›¾</a>
        <a class="hover:text-slate-200" href="#">åé¦ˆ</a>
      </div>
    </div>
  </footer>

  <script>
    // ======= å…¨å±€å˜é‡ä¸ DOM å…ƒç´  =======
    const KEY = 'vlarena.cards.v1';
    const cardsEl = document.getElementById('cards');
    const statusMessageEl = document.getElementById('statusMessage');
    let data = []; // å…¨å±€æ•°æ®ï¼Œç”±åˆå§‹åŒ–å‡½æ•°å¡«å……

    // ======= è‡ªå®šä¹‰ä¸‹æ‹‰ï¼šæŠŠåŸç”Ÿ <select> åŒ…è£…ä¸ºä¸€è‡´é£æ ¼ =======
    function enhanceSelect(select){
      if(!select || select.dataset.enhanced) return; select.dataset.enhanced='1';
      const wrap=document.createElement('div'); wrap.className='c-select';
      const btn=document.createElement('button'); btn.type='button'; btn.className='c-btn';
      const label=document.createElement('span'); label.textContent=select.options[select.selectedIndex]?.text || '';
      const arrow=document.createElement('span'); arrow.innerHTML='â–¾'; arrow.className='ml-2 opacity-70';
      const menu=document.createElement('div'); menu.className='c-menu hidden';
      // ç”Ÿæˆé€‰é¡¹
      Array.from(select.options).forEach((opt,i)=>{
        const item=document.createElement('div');
        item.className='c-opt'; item.setAttribute('role','option');
        if(opt.value===select.value) item.setAttribute('aria-selected','true');
        item.textContent=opt.text;
        item.addEventListener('click',()=>{ select.value=opt.value; label.textContent=opt.text; menu.classList.add('hidden');
          menu.querySelectorAll('.c-opt').forEach(x=>x.removeAttribute('aria-selected'));
          item.setAttribute('aria-selected','true');
          select.dispatchEvent(new Event('change',{bubbles:true}));
        });
        menu.appendChild(item);
      });
      // ç»“æ„æŒ‚è½½
      select.classList.add('sr-hidden');
      const parent=select.parentNode; parent.insertBefore(wrap, select); wrap.appendChild(select); wrap.appendChild(btn); btn.appendChild(label); btn.appendChild(arrow); wrap.appendChild(menu);
      // äº¤äº’
      btn.addEventListener('click',()=>{ menu.classList.toggle('hidden'); });
      document.addEventListener('click',(e)=>{ if(!wrap.contains(e.target)) menu.classList.add('hidden'); });
      // åŒæ­¥ï¼šå½“ä»£ç é‡Œæ”¹ value æ—¶
      select.addEventListener('change',()=>{ const match=Array.from(select.options).find(o=>o.value===select.value); if(match){ label.textContent=match.text; menu.querySelectorAll('.c-opt').forEach(x=>x.removeAttribute('aria-selected')); const idx=Array.from(select.options).indexOf(match); const optDiv=menu.children[idx]; if(optDiv) optDiv.setAttribute('aria-selected','true'); }});
    }

    // ======= æ•°æ®å±‚ï¼šJSON + localStorage æ··åˆæ¨¡å¼ =======
    async function initializeData() {
      showStatus('æ­£åœ¨åŠ è½½æ•°æ®...');
      const localData = localStorage.getItem(KEY);
      
      if (localData) {
        try {
          data = JSON.parse(localData);
          console.log('ä» localStorage åŠ è½½æ•°æ®ã€‚');
          return; // å¦‚æœæœ¬åœ°æœ‰æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨
        } catch (e) {
          console.error('è§£æ localStorage æ•°æ®å¤±è´¥:', e);
          // è§£æå¤±è´¥ï¼Œå°†å°è¯•ä» JSON æ–‡ä»¶æ¢å¤
        }
      }

      try {
        console.log('æœ¬åœ°æ— æ•°æ®æˆ–è§£æå¤±è´¥ï¼Œå°è¯•ä» datasets.json åŠ è½½ã€‚');
        const response = await fetch('./datasets.json');
        if (!response.ok) {
          throw new Error(`ç½‘ç»œå“åº”é”™è¯¯: ${response.statusText}`);
        }
        const jsonData = await response.json();
        data = jsonData;
        save(data); // å°†ä» JSON åŠ è½½çš„æ•°æ®å­˜å…¥ localStorage
        console.log('æˆåŠŸä» datasets.json åŠ è½½å¹¶ç¼“å­˜æ•°æ®ã€‚');
      } catch (error) {
        console.error('åŠ è½½ datasets.json å¤±è´¥:', error);
        showStatus('é”™è¯¯ï¼šæ— æ³•åŠ è½½é»˜è®¤æ•°æ®æ–‡ä»¶ (datasets.json)ã€‚è¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚', true);
      }
    }

    function save(list) {
      try {
        localStorage.setItem(KEY, JSON.stringify(list));
      } catch (e) {
        console.error('ä¿å­˜åˆ° localStorage å¤±è´¥:', e);
        alert('æ— æ³•ä¿å­˜æ•°æ®ï¼Œå¯èƒ½æ˜¯å­˜å‚¨ç©ºé—´å·²æ»¡ã€‚');
      }
    }

    // ======= è§†å›¾æ¸²æŸ“ä¸çŠ¶æ€æ˜¾ç¤º =======
    function showStatus(message, isError = false) {
      statusMessageEl.textContent = message;
      statusMessageEl.className = `rounded-2xl border p-8 text-center ${isError ? 'border-red-500/30 bg-red-500/10 text-red-300' : 'border-white/10 bg-white/5 text-slate-400'}`;
      statusMessageEl.classList.remove('hidden');
      cardsEl.classList.add('hidden');
    }

    function hideStatus() {
        statusMessageEl.classList.add('hidden');
        cardsEl.classList.remove('hidden');
    }
    
    function tagChip(t) { return `<span class="inline-flex items-center gap-1 px-2 py-0.5 text-xs rounded-lg bg-white/5 border border-white/10">${t}</span>` }

    function render(list = data) {
      cardsEl.innerHTML = '';
      if (!list.length) {
        showStatus('æ— åŒ¹é…ç»“æœã€‚è¯·å°è¯•è°ƒæ•´æœç´¢æˆ–ç­›é€‰æ¡ä»¶ã€‚');
        return;
      }
      
      hideStatus();
      list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'group rounded-2xl border border-white/10 bg-white/5 p-4 hover:bg-white/10 transition relative';
        card.draggable = true;
        card.dataset.id = item.id;
        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-xs ${item.type === 'benchmark' ? 'text-cyan-300' : 'text-indigo-300'}">${item.type.toUpperCase()}</div>
              <a href="detail.html?id=${item.id}" class="mt-1 block font-semibold leading-snug hover:underline">${item.name}</a>
              <p class="mt-1 text-sm text-slate-300">${item.desc || ''}</p>
              <div class="mt-2 flex flex-wrap gap-1">${(item.tags || []).map(tagChip).join('')}</div>
            </div>
            <div class="shrink-0 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition">
              ${item.repo ? `<a href="${item.repo}" target="_blank" title="ä»£ç ä»“åº“" class="rounded-lg px-2 py-1 bg-white/5 border border-white/10 hover:bg-white/10 text-sm">Code</a>` : ''}
              <button data-edit class="rounded-lg px-2 py-1 bg-white/5 border border-white/10 hover:bg-white/10 text-sm">ç¼–è¾‘</button>
              <button data-del class="rounded-lg px-2 py-1 bg-white/5 border border-white/10 hover:bg-white/10 text-sm text-red-300">åˆ é™¤</button>
              <span class="cursor-move rounded-lg px-2 py-1 bg-white/5 border border-white/10 text-xs" title="æ‹–æ‹½æ’åº">â†•</span>
            </div>
          </div>`;
        card.querySelector('[data-edit]').addEventListener('click', () => openModal(item));
        card.querySelector('[data-del]').addEventListener('click', () => delCard(item.id));
        card.addEventListener('dragstart', e => { card.classList.add('dragging'); e.dataTransfer.setData('text/plain', item.id); });
        card.addEventListener('dragend', () => card.classList.remove('dragging'));
        cardsEl.appendChild(card);
      });
    }

    // ======= äº‹ä»¶ç›‘å¬ä¸ä¸šåŠ¡é€»è¾‘ (å¤§éƒ¨åˆ†æ— å˜åŒ–) =======
    // æ‹–æ‹½æ’åº
    cardsEl.addEventListener('dragover', e => {
      e.preventDefault();
      const dragging = document.querySelector('.dragging');
      const after = getDragAfterElement(cardsEl, e.clientY);
      if (after == null) cardsEl.appendChild(dragging); else cardsEl.insertBefore(dragging, after);
    });
    function getDragAfterElement(container, y) {
      const els = [...container.querySelectorAll('[draggable]:not(.dragging)')];
      return els.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) { return { offset, element: child } } else return closest;
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // è¿‡æ»¤
    const searchInput = document.getElementById('searchInput');
    const typeFilter = document.getElementById('typeFilter');
    const tagFilter = document.getElementById('tagFilter');
    function applyFilter() {
      const q = (searchInput.value || '').toLowerCase();
      const type = typeFilter.value;
      const tags = (tagFilter.value || '').toLowerCase().split(',').map(s => s.trim()).filter(Boolean);
      const filtered = data.filter(it => {
        const text = (it.name + " " + (it.desc || '') + " " + (it.tags || []).join(' ')).toLowerCase();
        const okText = !q || text.includes(q);
        const okType = type === 'all' || it.type === type;
        const okTags = !tags.length || tags.every(t => (it.tags || []).join(' ').toLowerCase().includes(t));
        return okText && okType && okTags;
      });
      render(filtered);
    }
    searchInput.addEventListener('input', applyFilter);
    typeFilter.addEventListener('change', applyFilter);
    tagFilter.addEventListener('input', applyFilter);

    // æ–°å»º/ç¼–è¾‘
    const modal = document.getElementById('modal');
    const form = document.getElementById('cardForm');
    const modalTitle = document.getElementById('modalTitle');
    let editingId = null;
    function openModal(item) {
      editingId = item?.id || null;
      modalTitle.textContent = editingId ? 'ç¼–è¾‘å¡ç‰‡' : 'æ–°å»ºå¡ç‰‡';
      form.type.value = item?.type || 'benchmark';
      form.name.value = item?.name || '';
      form.desc.value = item?.desc || '';
      form.details.value = item?.details || '';
      form.homepage.value = item?.homepage || '';
      form.repo.value = item?.repo || '';
      form.tags.value = (item?.tags || []).join(', ');
      // åŒæ­¥è‡ªå®šä¹‰ä¸‹æ‹‰æ˜¾ç¤º
      form.type.dispatchEvent(new Event('change', {bubbles:true}));
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
    function closeModal() { modal.classList.add('hidden'); modal.classList.remove('flex'); }
    document.querySelectorAll('[data-dismiss]').forEach(el => el.addEventListener('click', closeModal));
    document.getElementById('addCardBtn').addEventListener('click', () => openModal(null));

    form.addEventListener('submit', e => {
      e.preventDefault();
      const payload = {
        id: editingId || crypto.randomUUID(),
        type: form.type.value,
        name: form.name.value.trim(),
        desc: form.desc.value.trim(),
        details: form.details.value.trim(),
        homepage: form.homepage.value.trim(),
        repo: form.repo.value.trim(),
        tags: (form.tags.value || '').split(',').map(s => s.trim()).filter(Boolean)
      };
      if (!payload.name) { alert('åç§°å¿…å¡«'); return }
      if (editingId) { data = data.map(d => d.id === editingId ? payload : d); }
      else { data = [payload, ...data]; }
      save(data);
      applyFilter();
      closeModal();
    });

    function delCard(id) {
      if (confirm('ç¡®å®šåˆ é™¤è¯¥å¡ç‰‡ï¼Ÿ')) {
        data = data.filter(d => d.id !== id);
        save(data);
        applyFilter();
      }
    }

    // å¯¼å‡º/å¯¼å…¥/æ¢å¤
    document.getElementById('exportBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'vlarena_datasets.json'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('importInput').addEventListener('change', async (e) => {
      const file = e.target.files?.[0]; if (!file) return;
      try {
        const text = await file.text();
        const json = JSON.parse(text);
        if (!Array.isArray(json)) throw new Error('JSON é¡¶å±‚åº”ä¸ºæ•°ç»„');
        const ok = json.every(x => x && typeof x.name === 'string' && (x.type === 'benchmark' || x.type === 'dataset'));
        if (!ok) throw new Error('å…ƒç´ å¿…é¡»åŒ…å« name ä¸” type âˆˆ {benchmark,dataset}');
        data = json.map(x => ({ id: x.id || crypto.randomUUID(), type: x.type, name: x.name, desc: x.desc || '', details: x.details || '', homepage: x.homepage || '', repo: x.repo || '', tags: Array.isArray(x.tags) ? x.tags : [] }));
        save(data);
        applyFilter();
        alert('å¯¼å…¥æˆåŠŸï¼š' + data.length + ' æ¡');
      } catch (err) {
        alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message);
      }
      e.target.value = '';
    });

    document.getElementById('restoreBtn').addEventListener('click', () => {
        if (confirm('ç¡®å®šè¦æ¢å¤ä¸ºé»˜è®¤æ•°æ®å—ï¼Ÿæ‚¨å½“å‰çš„æ‰€æœ‰ä¿®æ”¹éƒ½å°†ä¸¢å¤±ã€‚')) {
            localStorage.removeItem(KEY);
            location.reload(); // åˆ·æ–°é¡µé¢ä»¥é‡æ–°ä» JSON æ–‡ä»¶åŠ è½½
        }
    });

    // ======= é¡µé¢å¯åŠ¨å‡½æ•° =======
    async function main() {
      document.getElementById('year').textContent = new Date().getFullYear();
      await initializeData();
      applyFilter(); // åˆå§‹æ¸²æŸ“
      // å¯ç”¨ä¸‹æ‹‰æ¢çš®ï¼ˆç­›é€‰ + å¼¹çª—ï¼‰
      enhanceSelect(document.getElementById('typeFilter'));
      enhanceSelect(document.querySelector('#cardForm select[name="type"]'));
    }
    
    main(); // å¯åŠ¨åº”ç”¨

  </script>
</body>
</html>
